---
title: 'Lec 03: Data screening'
date: "Last Updated `r Sys.time()`"
output:
  html_document:
    highlight: tango
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r load2,echo=FALSE, warning=FALSE, message=FALSE}
library(knitr)
#library(rmarkdown)
opts_chunk$set(warning=FALSE, message=FALSE) 
```

# Data screening and transformations (_PMA5 Ch 4_)
Recall the aim of data preparation, screening, wrangling, or transforming is to 

* Identify outliers and inconsistent values
* Assess normality of the distribution
* Explore data transformations to aid description, inference. 


## Load data
Load in your cleaned depression data set. 
```{r}
depress <- read.table("C:/GitHub/website/static/data/Depress_081217.txt", 
                      sep="\t", header=TRUE) 
```

## Describe the distribution of income
Be sure to write out your description in paragraph form and discuss the location (measures of center), spread (measures of variance) and shape (normality or skewness) of the distribution using an appropriate plot and summary statistics as evidence. Connect your text to specific features of the plot and/or summary statistics, do not just say "as you can see in the plot...". Make sure the plot is fully annotated with an appropriate title and axes labels. 

```{r}
hist(depress$income, prob=TRUE, xlab="Annual income (in thousands)", 
     main="Histogram and Density curve of Income", ylab="")
lines(density(depress$income), col="blue")
summary(depress$income)
```

The distribution of annual income is slightly skewed right with a mean of $20.5k per year and a median of $15k per year income. The range of values goes from $2k to $65k. Reported income above $40k appear to have been rounded to the nearest  $10k, because there are noticeable peaks at $40k, $50k, and $60k. 

In general, transformations are more effective when the the standard deviation is large relative to the mean. One rule of thumb is if the sd/mean ratio is less than 1/4, a transformation may not be necessary. 
```{r}
sd(depress$income) / mean(depress$income)
```

Alternatively Hoaglin, Mosteller and Tukey (1985) showed that if the largest observation divided by the smallest observation is over 2, then the data may not be sufficiently variable for the transformation to be decisive. 
```{r}
max(depress$income) / (min(depress$income)+.1)
```

Note these rules are not meaningful for data without a natural zero. The book goes into more detail about options for interval data. 


## Assessing Normality
Another common method of assessing normality is to create a normal probability (or normal quantile) plot. 
```{r}
qqnorm(depress$income);qqline(depress$income, col="red")
```

The points on the normal probability plot do not follow the red reference line very well. The dots show a more curved, or `U` shaped form rather than following a linear line. This is another indication that the data is skewed and a transformation for normality should be created. 

# Transformations

## Taking logs 
Create three new variables: `log10inc` as the log base 10 of Income, `loginc` as the natural log of Income, and `xincome` which is equal to the negative of one divided by the cubic root of income. 

```{r}
log10inc <- log10(depress$income)
loginc   <- log(depress$income)
xincome  <- -1/(depress$income)^(-1/3)
```


Create a single plot that display normal probability plots for the original, and each of the three transformations of income. Here I use the base graphics grid organizer `par(mfrow=c(r,c))` where `r` is the number of rows and `c` is the number of columns to show these plots side by side.

```{r, fig.width=10, fig.height=10}
par(mfrow=c(2,2)) # Try (4,1) and (1,4) to see how this works. 
qqnorm(depress$income, main="Income"); qqline(depress$income,col="blue")
qqnorm(log10inc, main="Log 10"); qqline(log10inc, col="blue")
qqnorm(loginc, main = "Natural Log"); qqline(loginc, col="blue")
qqnorm(xincome, main="-1/cuberoot(income)"); qqline(xincome, col="blue")
```

Which transformation does a better job of normalizing the distribution of Income?
 
## logs of zero values
Take the logarithm of the CESD score plus 1 and compare the histograms of CESD and log(CESD+1). Describe the distribution of each. 
```{r}
par(mfrow=c(2,1))
hist(log(depress$cesd+1))
hist(depress$cesd)
```

Why was the +1 added to CESD prior to taking the log?




3. Using the Parental HIV data set, plot a histogram, boxplot, and a normal probability plot for the variable `AGESMOKE`. this variable is the age in years when the respondent started smoking. If the respondent did not start smoking, `AGESMOKE` was assigned to a value of zero. Decide what to do about the zero values and if a transformation should be used for this variable if the assumption of normality is made when it is used in a statistical analysis. 


 
# Session Info
This document was compiled on `r Sys.time()` and with the following system information:
```{r}
sessionInfo()
```